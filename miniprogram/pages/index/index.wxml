<!-- index.wxml -->
<view class="container">
  <view class="title">画个圣诞帽</view>
  <view class="top_tip">一键为你的头像添加圣诞帽</view>
  <!-- 用户卡片 -->
  <view class="avatar_card">
    <view class="avatar_preview">
      <image class="avatar_img" src="{{avatarUrl || defaultAvatar}}" mode="aspectFill"></image>
      <block wx:if="{{status === 'GENERATING'}}">
        <view class="loading_mask">
          <view class="loading_spinner"></view>
          <text class="loading_text">生成圣诞帽中...</text>
        </view>
      </block>
    </view>
    <view class="avatar_actions">
      <block wx:if="{{status === 'NONE'}}">
        <button class="avatar_btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
          选择头像
        </button>
      </block>
      <block wx:if="{{status === 'HAS_AVATAR'}}">
        <button class="avatar_btn avatar_btn--primary" bindtap="onAddHat">添加圣诞帽</button>
        <button class="avatar_btn avatar_btn--ghost" bindtap="onRestart">重新选择</button>
      </block>
      <block wx:if="{{status === 'GENERATING'}}">
        <button class="avatar_btn avatar_btn--primary" disabled="true">生成中，请稍候...</button>
        <text class="loading_subtext">需要耗时15秒左右, 请耐心等待</text>
      </block>
      <block wx:if="{{status === 'GENERATED'}}">
        <button class="avatar_btn avatar_btn--primary" bindtap="onDownload">下载头像</button>
        <button class="avatar_btn avatar_btn--ghost" open-type="share">转发头像</button>
        <button class="avatar_btn avatar_btn--ghost" bindtap="onRestart">重新开始</button>
      </block>
    </view>
  </view>
</view>